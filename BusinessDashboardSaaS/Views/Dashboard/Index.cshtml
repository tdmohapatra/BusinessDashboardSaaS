@{
    ViewData["Title"] = "Dashboard";
}

<h2 class="mb-3">Smart Business Dashboard</h2>

<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="card bg-light border-info shadow">
            <div class="card-body">
                <h5>Total Users</h5>
                <h2 id="totalUsers">0</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card bg-light border-primary shadow">
            <div class="card-body">
                <h5>Total Products</h5>
                <h2 id="totalProducts">0</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-light border-success shadow">
            <div class="card-body">
                <h5>Total Stock</h5>
                <h2 id="totalStock">0</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-light border-warning shadow">
            <div class="card-body">
                <h5>Average Price</h5>
                <h2 id="avgPrice">₹0</h2>
            </div>
        </div>
    </div>
</div>

<!-- Bar Chart -->
<canvas id="categoryChart" width="400" height="200"></canvas>
<hr class="mt-4" />

<h4 class="mt-3">Product Price Distribution (Pie)</h4>
<canvas id="pricePieChart" width="400" height="200"></canvas>

<h4 class="mt-4">Stock Over Time (Line Chart)</h4>
<canvas id="stockLineChart" width="400" height="200"></canvas>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function () {
            $.get("/Dashboard/GetDashboardStats", function (data) {
                // 🧾 Update Summary Cards
                $('#totalProducts').text(data.totalProducts);
                $('#totalStock').text(data.totalStock);
                $('#avgPrice').text("₹" + data.avgPrice.toFixed(2));
                $('#totalUsers').text(data.totalUsers);

                // 📊 Bar Chart: Products by Category
                const catLabels = data.byCategory.map(c => c.category);
                const catCounts = data.byCategory.map(c => c.count);

                new Chart(document.getElementById('categoryChart'), {
                    type: 'bar',
                    data: {
                        labels: catLabels,
                        datasets: [{
                            label: 'Products by Category',
                            data: catCounts,
                            backgroundColor: '#007bff',
                            borderColor: '#0056b3',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

                // 🥧 Pie Chart: Price Distribution by Category
                const pieData = data.byCategory.map(c => {
                    const category = c.category;
                    const productsInCat = data.allProducts
                        .filter(p => (p.category ?? 'Uncategorized') === category);
                    const totalPrice = productsInCat.reduce((sum, p) => sum + p.price, 0);
                    return { label: category, total: totalPrice };
                });

                new Chart(document.getElementById('pricePieChart'), {
                    type: 'pie',
                    data: {
                        labels: pieData.map(p => p.label),
                        datasets: [{
                            data: pieData.map(p => p.total.toFixed(2)),
                            backgroundColor: ['#f44336', '#2196f3', '#ffc107', '#4caf50', '#9c27b0']
                        }]
                    }
                });

                // 📈 Line Chart: Stock Over Time (Dummy)
                const stockTrend = {
                    labels: ["Day 1", "Day 2", "Day 3", "Day 4", "Day 5"],
                    data: [50, 80, 70, 100, 90]
                };

                new Chart(document.getElementById('stockLineChart'), {
                    type: 'line',
                    data: {
                        labels: stockTrend.labels,
                        datasets: [{
                            label: "Stock Trend",
                            data: stockTrend.data,
                            fill: false,
                            borderColor: '#28a745',
                            tension: 0.3
                        }]
                    }
                });
            });
        });
    </script>
}

